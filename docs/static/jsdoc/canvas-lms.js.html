<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: canvas-lms.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: canvas-lms.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* Power+ Canvas LMS Integration
Copyright (c) 2018-2020 jottocraft. All rights reserved.
Licenced under the GNU General Public License v2.0 (https://github.com/jottocraft/dtps/blob/master/LICENSE)
*/

/**
 * Common headers used for Canvas web requests
 */
dtps.lms.commonHeaders = { Accept: "application/json+canvas-string-ids, application/json" };

/**
 * Gets user data from Canvas
 * 
 * @return {Promise&lt;User>} A promise which resolves to a User object
 */
dtps.lms.fetchUser = function () {
    return new Promise(function (resolve, reject) {
        jQuery.ajax({
            url: "/api/v1/users/self",
            type: "GET",
            headers: dtps.lms.commonHeaders,
            success: function (data) {
                resolve({
                    name: data.name,
                    id: data.id,
                    photoURL: data.avatar_url
                });
            },
            error: function (err) {
                reject(err);
            }
        });
    })
}

/**
 * Gets course data from Canvas
 * 
 * @return {Promise&lt;Class[]>} A promise which resolves to an array of Class objects
 */
dtps.lms.fetchClasses = function () {
    return new Promise(function (resolve, reject) {
        jQuery.ajax({
            url: "/api/v1/users/self/colors",
            type: "GET",
            headers: dtps.lms.commonHeaders,
            success: function (colorData) {
                jQuery.ajax({
                    url: "/api/v1/users/self/dashboard_positions",
                    type: "GET",
                    headers: dtps.lms.commonHeaders,
                    success: function (dashboardData) {
                        jQuery.ajax({
                            url: "/api/v1/users/self/courses?per_page=100&amp;enrollment_state=active&amp;include[]=term&amp;include[]=total_scores&amp;include[]=public_description&amp;include[]=total_students&amp;include[]=account&amp;include[]=teachers&amp;include[]=course_image&amp;include[]=syllabus_body&amp;include[]=tabs",
                            type: "GET",
                            headers: dtps.lms.commonHeaders,
                            success: function (courseData) {
                                //All fetches have been completed successfully

                                var courses = [];

                                //Add courses from canvas to courses array as a DTPS course object
                                courseData.forEach((course, index) => {
                                    courses.push({
                                        name: course.course_code,
                                        id: course.id,
                                        num: index,
                                        subject: course.course_code.split(" - ")[0],
                                        syllabus: course.syllabus_body,
                                        description: course.public_description,
                                        numStudents: course.total_students,
                                        term: course.course_code.split(" - ")[1],
                                        color: colorData.custom_colors["course_" + course.id],
                                        grade: course.enrollments[0].computed_current_score,
                                        letter: course.enrollments[0].computed_current_grade,
                                        image: course.image_download_url,
                                        teacher: {
                                            name: course.teachers[0] &amp;&amp; course.teachers[0].display_name,
                                            id: course.teachers[0] &amp;&amp; course.teachers[0].id,
                                            photoURL: course.teachers[0] &amp;&amp; course.teachers[0].avatar_image_url
                                        }
                                    });
                                });

                                //Sort courses array
                                courses.sort(function (a, b) {
                                    var keyA = dashboardData.dashboard_positions["course_" + a.id],
                                        keyB = dashboardData.dashboard_positions["course_" + b.id];

                                    if (keyA &lt; keyB) return -1;
                                    if (keyA > keyB) return 1;
                                    return 0;
                                });

                                resolve(courses);
                            },
                            error: function (err) {
                                reject(err);
                            }
                        });
                    },
                    error: function (err) {
                        reject(err);
                    }
                });
            },
            error: function (err) {
                reject(err);
            }
        });
    })
}

/**
 * Gets assignment data from Canvas
 * 
 * @return {Promise&lt;Assignment[]>} A promise which resolves to an array of Assignment objects
 */
dtps.lms.fetchAssignments = function (classID) {
    return new Promise(function (resolve, reject) {
        jQuery.ajax({
            url: "/api/v1/courses/" + classID + "/outcome_results?per_page=100&amp;user_ids[]=" + dtps.user.id,
            type: "GET",
            headers: dtps.lms.commonHeaders,
            success: function (outcomeData) {
                jQuery.ajax({
                    url: "/api/v1/courses/" + classID + "/assignment_groups?per_page=100&amp;include[]=assignments&amp;include[]=submissions&amp;include[]=submission",
                    type: "GET",
                    headers: dtps.lms.commonHeaders,
                    success: function (assignmentGroupData) {
                        //All fetches have been completed successfully
                        var assignments = [];

                        //Add assignments from canvas to assignments array as a DTPS assignment object
                        assignmentGroupData.forEach(group => {
                            group.assignments.forEach((assignment, index) => {
                                assignments.push({
                                    title: assignment.name,
                                    body: assignment.description,
                                    id: assignment.id,
                                    dueAt: assignment.due_at,
                                    url: assignment.html_url,
                                    turnedIn: (assignment.submission ? (assignment.submission.submission_type !== null) : false),
                                    late: assignment.submission &amp;&amp; assignment.submission.late,
                                    category: assignmentGroupData.length == 1 ? null : assignmentGroupData.name,
                                    publishedAt: assignment.created_at,
                                    gradedAt: assignment.submission &amp;&amp; assignment.submission.graded_at,
                                    grade: 100,
                                    letter: "A",
                                    value: assignment.points_possible,
                                    rubric: [
                                        {
                                            name: "Item 1",
                                            description: "AAAAAAAA",
                                            grade: 3.5,
                                            value: 4
                                        }
                                    ]
                                });
                            });
                        });

                        resolve(assignments);
                    },
                    error: function (err) {
                        reject(err);
                    }
                });
            },
            error: function (err) {
                reject(err);
            }
        });
    })
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun May 10 2020 13:22:52 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
